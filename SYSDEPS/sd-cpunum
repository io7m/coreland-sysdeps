#!/bin/sh

if [ $# -ne 1 ]
then
  echo "sd-cpunum: usage: os" 1>&2
  exit 1
fi

sys="$1"

case "$sys" in
  SD_SYSINFO_OS_LINUX)
    ncpu="`grep -i '^processor' /proc/cpuinfo | wc -l`"
    ;;
  SD_SYSINFO_OS_CRAY_UNICOS)
    ncpu="`getconf CRAY_NCPU`"
    ;;
  SD_SYSINFO_OS_IRIX)
    ncpu="`getconf NUM_PROCESSORS`"
    ;;
  SD_SYSINFO_OS_SUNOS)
    ncpu="`psrinfo -v | grep "Status of" | wc -l`"
    ;;
  SD_SYSINFO_OS_VMS)
    ncpu="`SHOW CPU /BRIEF | grep CPU | wc -l | tr -d ' '`"
    ;;
  *)
    ncpu="`sysctl hw.ncpu`"
    if [ $? -eq 0 ]
    then
      ncpu="`echo ${ncpu} | awk '{print $NF}'`"
    else
      ncpu=0
    fi
    ;;
esac

echo "${ncpu}"
